---
title: 小程序：普通转发分享与外链转发分享
date: 2019-11-04
tags:
  - 小程序
categories:
  - 小程序
---

:::tip
普通转发
小程序的分享可以来自用户点击 button 按钮，也可以用户主动点击右上角的分享，都会调取 onShareAppMessage 这个函数。
Page({
  onShareAppMessage: function (res) {
  	console.log('开始分享')
    if (res.from === 'button') {
      // 来自页面内转发按钮
     ...
:::

<!-- more -->

@[TOC]
## 普通转发
小程序的分享可以来自用户点击 button 按钮，也可以用户主动点击右上角的分享，都会调取 onShareAppMessage 这个函数。
```js
Page({
  onShareAppMessage: function (res) {
  	console.log('开始分享')
    if (res.from === 'button') {
      // 来自页面内转发按钮
      console.log(res.target)
    }
    return {
      title: '自定义转发标题',
      path: '/page/user?id=123',
      imageUrl: ''
    }
  }
})
```
##### 1. 按钮分享
需要在页面上的 button 按钮上加 `open-type="share"`
`<button open-type="share">去分享</button>`
##### 2. 右上角分享
用户点击直接触发函数

>小科普：小程序取消了分享成功失败的回调函数，如下图所示，所以没法检测用户是否分享成功，只能够检测用户点开分享的这个动作

![在这里插入图片描述](https://img-blog.csdnimg.cn/20191104104603636.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80Mzk3MjQzNw==,size_16,color_FFFFFF,t_70)
## webview分享
目录结构：
├── pages
│ ├── web-view
│ │ ├── web-view.js
│ │ ├── web-view.wxml
```html
<!-- pages/web-view/web-view.wxml -->
<web-view src="{{ url }}"
          bindload="loadFinish"
          bindmessage="messageFinish" />
```
```js
// pages/web-view/web-view.js
onLoad: function (options) {
  if (options.url) {
    this.setData({
      url: decodeURIComponent(options.url)
    })
  }
},
onShareAppMessage: function (options) {
  // options.webViewUrl 是当前web-view的链接
  return {
    path: '/pages/web-view/web-view?url=' + encodeURIComponent(options.webViewUrl)
  }
}
```
```js
// 别的页面跳转到webview页面
wx.navigateTo({
      url: '/pages/web-view/web-view?url=' + encodeURIComponent(url)
    })
})
```
