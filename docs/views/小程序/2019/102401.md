---
title: 小程序：获取用户信息的几种方案
date: 2019-10-24
tags:
  - 小程序
categories:
  - 小程序
---

:::tip
老方案（已废弃）
之前微信小程序获取用户信息
onLoad: function (options) {
    var that = this;
    //获取用户信息
    wx.getUserInfo({
        success: function (res) {
            console.log(res);
            that.data.userInf...
:::

<!-- more -->

## 老方案（已废弃）
之前微信小程序获取用户信息
```js
onLoad: function (options) {
    var that = this;
    //获取用户信息
    wx.getUserInfo({
        success: function (res) {
            console.log(res);
            that.data.userInfo = res.userInfo;
            that.setData({
                userInfo: that.data.userInfo
            })
        }
    })
}
```
这里需要用户授权，也就是刚进页面会有个弹框。但是后来微信接口有了新的调整，不允许这样了，需要 button 按钮做引导。
>线上环境依然可以用
## 新方案
```html
<!-- 需要使用 button 来授权登录 -->
<button wx:if="{{canIUse}}" open-type="getUserInfo" bindgetuserinfo="bindGetUserInfo">授权登录</button>
<view wx:else>请升级微信版本</view>
```
```js
Page({
  data: {
    canIUse: wx.canIUse('button.open-type.getUserInfo')
  },
  onLoad: function() {
    // 查看是否授权
    wx.getSetting({
      success: function(res){
        if (res.authSetting['scope.userInfo']) {
          // 已经授权，可以直接调用 getUserInfo 获取头像昵称
          wx.getUserInfo({
            success: function(res) {
              console.log(res.userInfo)
            }
          })
        }
      }
    })
  },
  bindGetUserInfo: function(e) {
    console.log(e.detail.userInfo)
  }
})
```
## 仅展示头像昵称
如果只是展示用户头像昵称，可以使用 `<open-data />` 组件
```html
<open-data type="userAvatarUrl"></open-data>
<open-data type="userNickName"></open-data>
```
