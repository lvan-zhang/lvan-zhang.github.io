---
title: shell：基础知识大汇总
date: 2019-11-13
tags:
  - 运维
categories:
  - 运维
---

:::tip
变量
普通：my_name="zy"
只读：readonly my_name
删除：unset my_name

变量名和等号之间不能有空格

使用变量
前面加美元符号
your_name="qinjx"
echo $your_name
# 或
echo ${your_name}

字符串
拼接：
your_name="zy"

# 使用双引号拼接
greeting="hello, "$your_...
:::

<!-- more -->

## 变量
普通：`my_name="zy"`
只读：`readonly my_name`
删除：`unset my_name`
- 变量名和等号之间不能有空格
## 使用变量
前面加美元符号
```shell
your_name="qinjx"
echo $your_name
# 或
echo ${your_name}
```
## 字符串
拼接：
```shell
your_name="zy"

# 使用双引号拼接
greeting="hello, "$your_name" !"
greeting_1="hello, ${your_name} !"
# hello, runoob ! hello, runoob !

# 使用单引号拼接
greeting_2='hello, '$your_name' !'
greeting_3='hello, ${your_name} !'
# hello, runoob ! hello, ${your_name} !
```

获取长度：
```shell
string="abcd"
echo ${#string} #输出 4
```

提取子字符串：
```shell
string="runoob is a great site"
echo ${string:1:4} # 输出 unoo
```
## 数组
定义：
```shell
array_name=(value0 value1 value2 value3)
```
读取：
```shell
valuen=${array_name[n]}
# 使用 @ 符号可以获取数组中的所有元素，例如：
echo ${array_name[@]}
```
获取长度（同字符串）：
```shell
# 取得数组元素的个数
length=${#array_name[@]}
# 或者
length=${#array_name[*]}
# 取得数组单个元素的长度
lengthn=${#array_name[n]}
```
## 注释
单行： `#`
多行：
```shell
:<<EOF
注释内容...
注释内容...
注释内容...
EOF
```
## 参数传递
```shell
echo "Shell 传递参数实例！";
echo "执行的文件名：$0";
echo "第一个参数为：$1";
echo "第二个参数为：$2";
echo "第三个参数为：$3";
```
```shell
# 执行
$ ./test.sh 1 2 3
# 输出
执行的文件名：./test.sh
第一个参数为：1
第二个参数为：2
第三个参数为：3
```
## 运算符
原生bash不支持简单的数学运算，但是可以通过其他命令来实现，例如 awk 和 expr，expr 最常用。

expr 是一款表达式计算工具，使用它能完成表达式的求值操作。
```shell
val=`expr 2 + 2`
echo "两数之和为 : $val"
```
- 表达式和运算符之间要有空格，例如 2+2 是不对的，必须写成 2 + 2，这与我们熟悉的大多数编程语言不一样。

## echo命令
显示变量：
```shell
read name 
echo "$name It is a test"
# 结果就像shell输入密码一样
```
显示结果定向至文件：
```shell
echo "It is a test" > myfile
```
显示命令执行结果：
```shell
echo `date`
# 2019年11月13日 星期三 18时53分47秒 CST
```
## printf
`printf  format-string  [arguments...]`
可以用格式替换符，比如：
```shell
printf "%-10s %-8s %-4s\n" 姓名 性别 体重kg  
printf "%-10s %-8s %-4.2f\n" 郭靖 男 66.1234 
printf "%-10s %-8s %-4.2f\n" 杨过 男 48.6543 
printf "%-10s %-8s %-4.2f\n" 郭芙 女 47.9876 

姓名     性别   体重kg
郭靖     男      66.12
杨过     男      48.65
郭芙     女      47.99
```
%s %c %d %f都是格式替代符

%-10s 指一个宽度为10个字符（-表示左对齐，没有则表示右对齐），任何字符都会被显示在10个字符宽的字符内，如果不足则自动以空格填充，超过也会将内容全部显示出来。

%-4.2f 指格式化为小数，其中.2指保留2位小数。
## test
测试是否相等
## if...else...
```shell
if condition
then
    command1 
    command2
    ...
    commandN
else
    command
fi

```
```shell
a=10
b=20
if [ $a == $b ]
then
   echo "a 等于 b"
elif [ $a -gt $b ]
then
   echo "a 大于 b"
elif [ $a -lt $b ]
then
   echo "a 小于 b"
else
   echo "没有符合的条件"
fi
```
## for
```shell
for loop in 1 2 3 4 5
do
    echo "The value is: $loop"
done

# 输出
The value is: 1
The value is: 2
The value is: 3
The value is: 4
The value is: 5
```
## while
```shell
# 无限循环
while true
do
    command
done
```
# case
# break
## 函数
普通函数：
```shell
funWithReturn(){
    echo "这个函数会对输入的两个数字进行相加运算..."
    echo "输入第一个数字: "
    read aNum
    echo "输入第二个数字: "
    read anotherNum
    echo "两个数字分别为 $aNum 和 $anotherNum !"
    return $(($aNum+$anotherNum))
}
funWithReturn
echo "输入的两个数字之和为 $? !"

# 输出
这个函数会对输入的两个数字进行相加运算...
输入第一个数字: 
1
输入第二个数字: 
2
两个数字分别为 1 和 2 !
输入的两个数字之和为 3 !
```
函数返回值在调用该函数后通过 $? 来获得。

参数函数：
```shell
funWithParam(){
    echo "第一个参数为 $1 !"
    echo "第二个参数为 $2 !"
    echo "第十个参数为 $10 !"
    echo "第十个参数为 ${10} !"
    echo "第十一个参数为 ${11} !"
    echo "参数总数有 $# 个!"
    echo "作为一个字符串输出所有参数 $* !"
}
funWithParam 1 2 3 4 5 6 7 8 9 34 73

# 输出
第一个参数为 1 !
第二个参数为 2 !
第十个参数为 10 !
第十个参数为 34 !
第十一个参数为 73 !
参数总数有 11 个!
作为一个字符串输出所有参数 1 2 3 4 5 6 7 8 9 34 73 !
```
注意，$10 不能获取第十个参数，获取第十个参数需要${10}。当n>=10时，需要使用${n}来获取参数。

另外，还有几个特殊字符用来处理参数：
参数 | 说明
------ | :-------
$# | 传递到脚本的参数个数
$*	 | 以一个单字符串显示所有向脚本传递的参数
$$ | 	脚本运行的当前进程ID号
$!	 | 后台运行的最后一个进程的ID号
$@	 | 与$*相同，但是使用时加引号，并在引号中返回每个参数。
$-	 | 显示Shell使用的当前选项，与set命令功能相同。
$?	 | 显示最后命令的退出状态。0表示没有错误，其他任何值表明有错误。
## 输入/输出重定向
命令	| 说明
------ | -------
command > file	| 将输出重定向到 file。
command < file	| 将输入重定向到 file。
command >> file	| 将输出以追加的方式重定向到 file。
n > file	| 将文件描述符为 n 的文件重定向到 file。
n >> file	| 将文件描述符为 n 的文件以追加的方式重定向到 file。
n >& m	| 将输出文件 m 和 n 合并。
n <& m	| 将输入文件 m 和 n 合并。
<< tag	| 将开始标记 tag 和结束标记 tag 之间的内容作为输入。
>文件描述符 0 通常是标准输入（STDIN），1 是标准输出（STDOUT），2 是标准错误输出（STDERR）。

输出重定向：
```shell
echo "你好" > users

cat users
你好
```
如果不希望文件内容被覆盖，可以使用 >> 追加到文件末尾

输入重定向：
本来需要从键盘获取输入的命令会转移到文件读取内容。

/dev/null 文件：
如果希望执行某个命令，但又不希望在屏幕上显示输出结果，那么可以将输出重定向到 /dev/null：
`command > /dev/null`
## 文件包含
语法：
```shell
. filename   # 注意点号(.)和文件名中间有一空格
# 或
source filename
```

举例：
test1.sh 代码如下：
```shell
url="http://www.zy.com"
```
test2.sh 代码如下：
```shell
#使用 . 号来引用test1.sh 文件
. ./test1.sh

# 或者使用以下包含文件代码
# source ./test1.sh

echo "我的地址：$url"
```
