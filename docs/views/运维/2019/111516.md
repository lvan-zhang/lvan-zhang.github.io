---
title: 搭建私有gitlab
date: 2019-11-15
tags:
  - 运维
categories:
  - 运维
---

:::tip
前言
稍具规模一点的公司都会搭建属于自己的git，svn，而内部git用的最多的则是gitlab，虽然官网已经提供了非常多的功能，但内网搭建更能保证项目的私有性，只有公司内部员工才可以访问，更加安全。
GitLab分为社区版（GitLab Community Edition）和企业版（GitLab Enterprise Edition）。社区版免费，企业版收费，但是功能比社区版多。根据目前的需求，...
:::

<!-- more -->

## 前言
稍具规模一点的公司都会搭建属于自己的git，svn，而内部git用的最多的则是gitlab，虽然官网已经提供了非常多的功能，但内网搭建更能保证项目的私有性，只有公司内部员工才可以访问，更加安全。

GitLab分为社区版（GitLab Community Edition）和企业版（GitLab Enterprise Edition）。社区版免费，企业版收费，但是功能比社区版多。根据目前的需求，选择安装社区版（GitLab-CE）。
## 前提
- 部署 gitlab 的服务器至少 2 核 4G 的配置，之前我的服务器 2 核 2G，装了gitlab跑起来直接吃掉了 1.3 G 的内存，命令行都卡的动不了，都是泪啊。。
- 将端口 http（80）加入安全组。

## 步骤
1. 安装依赖包。
	```shell
	sudo yum install -y curl policycoreutils-python openssh-server
	```
2. 设置SSH开机自启动并启动SSH服务。
	```shell
	sudo systemctl enable sshd
	sudo systemctl start sshd
	```
3. 安装Postfix来发送通知邮件。
	```shell
	sudo yum install postfix
	```
4. 设置Postfix开机自启动。
	```shell
	sudo systemctl enable postfix
	```
5. 启动Postfix服务。
	```shell
	1. 运行命令vim /etc/postfix/main.cf打开main.cf文件，找到内容：inet_interfaces = localhost
	2. 改为 inet_interfaces = all
	3. 运行命令sudo systemctl start postfix启动Postfix服务。
	```
6. 添加GitLab软件包仓库。
	```shell
	curl https://packages.gitlab.com/install/repositories/gitlab/gitlab-ce/script.rpm.sh | sudo bash
	```
7. 安装GitLab。
	```shell
	sudo EXTERNAL_URL="GitLab服务器的公网IP地址" yum install -y gitlab-ce
	```
8. 使用浏览器访问GitLab服务器的公网IP地址。
返回页面如下图所示，说明环境搭建成功。
![在这里插入图片描述](https://img-blog.csdnimg.cn/20191115111908725.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80Mzk3MjQzNw==,size_16,color_FFFFFF,t_70)
## 使用gitlab
1. 登录gitlab
	```shell
	1. 在浏览器输入公网ip即可进入gitlab登录页面，首次登录使用用户名 `root`
	2. 首次登录会强制用户修改密码。密码修改成功后，输入新密码进行登录。
	```
2. 创建project
	```shell
	1. 安装git（有的话省略）
	   yum install git
	2. 生成密钥文件。
	   使用ssh-keygen生成密钥文件.ssh/id_rsa，再将公钥文件id-rsa.pub中的内容粘帖到GitLab服务器的SSH-key的配置文件中。(和普通gitlab使用一样)
	3. 在gitlab主页新建一个project
	4. 添加ssh key，导入步骤2中生成的密钥文件内容。
	```
3. 简单配置
	```shell
	1. 配置使用Git仓库的人员姓名，email。
	   git config --global user.name "testname" 
	   git config --global user.email "abc@example.com" 
	2. 克隆项目
	   git clone git@iZxxxxxxxxxxxxxxxxx3Z:root/test.git
	```
4. 上传文件
	```shell
	进入项目目录，更改文件然后push一下就行
	```
