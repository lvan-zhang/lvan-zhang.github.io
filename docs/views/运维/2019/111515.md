---
title: centOS手动部署LNMP环境
date: 2019-11-15
tags:
  - 运维
categories:
  - 运维
---

:::tip
准备工作
1. 关闭防火墙
1.1. 运行 systemctl status firewalld 命令查看当前防火墙的状态。

如果防火墙的状态参数 Active 是 inactive，则防火墙为关闭状态。
如果防火墙的状态参数 Active 是 active，则防火墙为开启状态。

1.2. 关闭防火墙。

临时关闭（重启linux会开启）： systemctl stop firewalld
永...
:::

<!-- more -->

## 准备工作
### 1. 关闭防火墙
1.1. 运行 `systemctl status firewalld` 命令查看当前防火墙的状态。
- 如果防火墙的状态参数 Active 是 inactive，则防火墙为关闭状态。
- 如果防火墙的状态参数 Active 是 active，则防火墙为开启状态。

1.2. 关闭防火墙。
- 临时关闭（重启linux会开启）： `systemctl stop firewalld`
- 永久关闭（需要手动开启）： `systemctl disable firewalld`
### 2. 关闭SELinux
安全增强型 Linux（Security-Enhanced Linux）简称 SELinux，它是一个 Linux 内核模块，也是 Linux 的一个安全子系统。SELinux 的结构及配置非常复杂，而且有大量概念性的东西，要学精难度较大。很多 Linux 系统管理员嫌麻烦都把 SELinux 关闭了。

2.1. 运行 `getenforce` 命令查看SELinux的状态。
- 如果SELinux的状态参数是 Disabled，则SELinux为关闭状态。
- 如果SELinux的状态参数是 Enforcing，则SELinux为开启状态。
2.2. 关闭SELinux。
- 临时关闭（重启linux会开启）： `setenforce 0`
- 永久关闭（需要手动开启）： `vi /etc/selinux/config`  -> `SELINUX=enforcing改为SELINUX=disabled`
## 正式安装
### 安装nginx
```shell
# 安装
yum -y install nginx
# 版本
nginx -v
```
### 安装myql
1. 运行以下命令更新YUM源。
	```shell
	rpm -Uvh  http://dev.mysql.com/get/mysql57-community-release-el7-9.noarch.rpm
	```
2. 运行以下命令安装MySQL。
	```shell
	yum -y install mysql-community-server
	```
3. 运行以下命令查看MySQL版本号。
	```shell
	mysql -V
	```
### 安装php
1. 运行以下命令更新YUM源。
	```shell
	yum install -y http://dl.iuscommunity.org/pub/ius/stable/CentOS/7/x86_64/ius-release-1.0-15.ius.centos7.noarch.rpm
	rpm -Uvh https://mirror.webtatic.com/yum/el7/webtatic-release.rpm
	```
	>本教程以ius-release-1.0-15.ius.centos7.noarch.rpm版本为例。实际安装过程中，请您使用最新版本ius-release软件包。
	
2. 运行以下命令安装php。
	```shell
	yum -y install php70w-devel php70w.x86_64 php70w-cli.x86_64 php70w-common.x86_64 php70w-gd.x86_64 php70w-ldap.x86_64 php70w-mbstring.x86_64 php70w-mcrypt.x86_64  php70w-pdo.x86_64   php70w-mysqlnd  php70w-fpm php70w-opcache php70w-pecl-redis php70w-pecl-mongo
	```
3. 运行以下命令查看php版本号。
	```shell
	php -v
	```
## 配置
### 配置nginx
1. 运行以下命令备份Nginx配置文件。
	```shell
	cp /etc/nginx/nginx.conf /etc/nginx/nginx.conf.bak
	```
2. 运行以下命令打开Nginx配置文件。
	```shell
	vim /etc/nginx/nginx.conf
	```
3. 在Server大括号内，添加下列配置信息，使Nginx支持PHP请求。
	```shell
	location / {
        index index.php index.html index.htm;
    }
    #配置Nginx通过fastcgi方式处理您的PHP请求
    location ~ .php$ {
        root /usr/share/php; #请将/usr/share/php替换为您的网站根目录
        fastcgi_pass 127.0.0.1:9000; #Nginx通过本机的9000端口将PHP请求转发给PHP-FPM进行处理
        fastcgi_index index.php;
        fastcgi_param  SCRIPT_FILENAME  $document_root$fastcgi_script_name;
        include fastcgi_params;  #Nginx调用fastcgi接口处理PHP请求
    }   
	```
4. 运行以下命令打开Nginx配置文件。
	```shell
	systemctl start nginx
	```
5. 运行以下命令设置Nginx服务开机自启动。
	```shell
	systemctl enable nginx
	```
### 配置mysql
1. 运行以下命令启动MySQL服务。
	```shell
	systemctl start mysqld
	```
2. 运行以下命令设置MySQL服务开机自启动。
	```shell
	systemctl enable mysqld
	```
3. 运行以下命令查看/var/log/mysqld.log文件，获取并记录root用户的初始密码。
	```shell
	# grep 'temporary password' /var/log/mysqld.log
	2016-12-13T14:57:47.535748Z 1 [Note] A temporary password is generated for root@localhost: p0/G28g>lsHD
	# 下一步重置root用户密码时，会使用该初始密码。
	```
4. 重置root账号密码。
	```shell
	mysql_secure_installation
	```
	```shell
	Enter password for user root: #输入上一步获取的root用户初始密码
	The 'validate_password' plugin is installed on the server.
	The subsequent steps will run with the existing configuration of the plugin.
	Using existing password for root.
	Estimated strength of the password: 100 
	Change the password for root ? ((Press y|Y for Yes, any other key for No) : Y #是否更改root用户密码，输入Y
	New password: #输入新密码，长度为8至30个字符，必须同时包含大小写英文字母、数字和特殊符号。特殊符号可以是()` ~!@#$%^&*-+=|{}[]:;‘<>,.?/
	Re-enter new password: #再次输入新密码
	Estimated strength of the password: 100 
	Do you wish to continue with the password provided?(Press y|Y for Yes, any other key for No) : Y
	```
	之后一路 Y 就好了
### 配置php
1. 在/usr/share/php目录下新建phpinfo.php文件，用于展示phpinfo信息。
	```shell
	<?php echo phpinfo(); ?>
	```
2. 运行以下命令启动PHP-FPM。
	```shell
	systemctl start php-fpm
	```
3. 运行以下命令设置PHP-FPM开机自启动。
	```shell
	systemctl enable php-fpm
	```
## 测试
浏览器输入 `http://<ECS实例公网IP地址>/phpinfo.php`
