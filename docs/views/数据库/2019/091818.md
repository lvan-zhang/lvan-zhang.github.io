---
title: mongodb：基本概念和操作
date: 2019-09-18
tags:
  - 数据库
categories:
  - 数据库
---

:::tip
基本命令
查看所有数据库：show dbs
查看当前数据库：db
使用某个数据库：use test（如果不存在则会创建）
插入：db.students.insertOne(["name":"Jack"])
显示所有集合：show collections
查询集合中的所有数据：db.students.find()

...
:::

<!-- more -->

## 基本概念
数据库（database）：qq，wechat
集合（collection）：users，products（相当于表 table）
文档（document）：`{ name: '张三', age: 15 }`（相当于数据记录行 row）
域（field）：name（相当于数据字段 column）
主键（primary key）：MongoDB 自动将 _id 字段设置为主键
```javascript
{
  qq: {
    users: [
      {
        name: '张三',
        age: 15
      },
      {
        name: '李四',
        age: 18
      }
    ],
    products: [

    ]
  },
  wechat: {
    
  }
}
```
## 特点
一切都是动态的，不需要像 MySQL 一样先创建数据库、表、设计表结构，只需要当你插入数据的时候，指定往哪个库哪个集合插入就行。
## 基本命令
MongoDB 中默认的数据库为 test，如果你没有创建新的数据库，集合将存放在 test 数据库中。
### 基本：
查看所有数据库：`show dbs`
查看当前数据库：`db`
查看所有集合：`show collections` 或 `show tables`
使用某个数据库：`use test`（如果不存在则会创建，但是必须插入一条数据 `show dbs` 才会显示）
### 增：
插入文档：`db.COLLECTION_NAME.insert(document)` 或者 `save()`
### 删：
删除当前数据库：`db.dropDatabase()`
删除集合：`db.COLLECTION_NAME.drop()`
### 改：
插入文档：`db.COLLECTION_NAME.insert(document)` 或者 `save()`
### 查：
查询集合中的所有数据：`db.students.find()`

## 小例子
```javascript
var mongoose = require('mongoose')

var Schema = mongoose.Schema

// 1. 连接数据库
// 指定连接的数据库不需要存在，当你插入第一条数据之后就会自动被创建出来
mongoose.connect('mongodb://localhost/itcast')

// 2. 设计文档结构（表结构）
// 字段名称就是表结构中的属性名称
// 约束的目的是为了保证数据的完整性，不要有脏数据
var userSchema = new Schema({
  username: {
    type: String,
    required: true // 必须有
  },
  password: {
    type: String,
    required: true
  },
  email: {
    type: String
  }
})

// 3. 将文档结构发布为模型
//    mongoose.model 方法就是用来将一个架构发布为 model
//    第一个参数：传入一个大写名词单数字符串用来表示你的数据库名称
//                 mongoose 会自动将大写名词的字符串生成 小写复数 的集合名称
//                 例如这里的 User 最终会变为 users 集合名称
//    第二个参数：架构 Schema
//   
//    返回值：模型构造函数
var User = mongoose.model('User', userSchema)

// 4. 当我们有了模型构造函数之后，就可以使用这个构造函数对 users 集合中的数据为所欲为了（增删改查）
// **********************
// #region /新增数据
// **********************
// var admin = new User({
//   username: 'zs',
//   password: '123456',
//   email: 'admin@admin.com'
// })

// admin.save(function (err, ret) {
//   if (err) {
//     console.log('保存失败')
//   } else {
//     console.log('保存成功')
//     console.log(ret)
//   }
// })
// **********************
// #endregion /新增数据
// **********************




// **********************
// #region /查询数据
// **********************
// User.find(function (err, ret) {
//   if (err) {
//     console.log('查询失败')
//   } else {
//     console.log(ret)
//   }
// })

// User.find({
//   username: 'zs'
// }, function (err, ret) {
//   if (err) {
//     console.log('查询失败')
//   } else {
//     console.log(ret)
//   }
// })

// User.findOne({
//   username: 'zs'
// }, function (err, ret) {
//   if (err) {
//     console.log('查询失败')
//   } else {
//     console.log(ret)
//   }
// })
// **********************
// #endregion /查询数据
// **********************



// **********************
// #region /删除数据
// **********************
// User.remove({
//   username: 'zs'
// }, function (err, ret) {
//   if (err) {
//     console.log('删除失败')
//   } else {
//     console.log('删除成功')
//     console.log(ret)
//   }
// })
// **********************
// #endregion /删除数据
// **********************


// **********************
// #region /更新数据
// **********************
// User.findByIdAndUpdate('5a001b23d219eb00c8581184', {
//   password: '123'
// }, function (err, ret) {
//   if (err) {
//     console.log('更新失败')
//   } else {
//     console.log('更新成功')
//   }
// })
// **********************
// #endregion /更新数据
// **********************

```
